function log(e){console.log(e)}function onSuccess(e,t){log(" My custom success"),$("form img").attr("src","img/done.gif"),setTimeout(function(){console.log("timeout"),$("form img").fadeOut(500,function(){$("#label").fadeIn(700),$("#label p").remove(),$("#label").css("font-size","50px"),$("#label i").css("display","inline-block"),$(".download").removeAttr("style")}),document.getElementById("send").disabled=!1},2e3),writeUserData(t,e)}function onError(){log("My custom error"),$("img").attr("src","img/lol.gif"),document.getElementById("send").disabled=!1}function onProgress(e){var t=parseInt(e.bytesTransferred/e.totalBytes*100);log("progress "+t+"% / "+e.totalBytes),$(".dnl-progress").css("width",t+"%"),$(".dnl-progress").text(t+"%"),$(".download").css("display","block"),$("#label").css("display","none"),$("#file").css("display","none"),$("form img").remove(),$("form").prepend("<img src='img/waiting-circle.gif' style=\"height: 200px;\">"),document.getElementById("send").disabled=!0}function generateKey(e){for(var t="ABSCEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o="",l=0;l<e;l++)o+=t.charAt(Math.floor(Math.random()*t.length));return o}function writeUserData(t,o){var l,n;firebase.database().ref("files/"+t).once("value").then(function(e){l=Object.size(e.val()),console.log("update data"),n='<li name="'+l+'"">'+o+'<div class="icon-wrap text-right"><i class="fas fa-trash-alt"><span class="tooltip">Видалити файл</span></i></div></li>',document.querySelectorAll(".template").forEach(function(e){e&&(console.log("elem "+e+" is removed from the DOM"),e.remove())}),$(".file-list ul").append(n),dataObj={},dataObj[l]=o,console.log("writeUserData: name = ",o),dataObj.CreateDate=new Date,firebase.database().ref("files/"+t).update(dataObj)}).catch(function(e){console.log("some error in writing data in database"),showErrorMSG("writting data in database",e)})}$(function(){var n,a="",i=document.getElementById("main-screen"),r=document.getElementById("filesScreen"),c=document.getElementsByTagName("form")[0],d=document.getElementsByClassName("file-list")[0],u=document.querySelector(".key-input"),m=document.querySelector(".main-window"),o=document.querySelector(".modal-message");document.getElementById("file").addEventListener("change",function(e){var t=$("#file").val();n=e.target.files[0];var o=t[2],l=t.split(o);$("#label").append("<p>"+l[l.length-1]+"</p>").css("font-size","14px"),$("#label i").css("display","none")});firebase.initializeApp({apiKey:"AIzaSyCCQ1baclGhVTSAWZ-ZNzgYDGBWKRtFfkU",authDomain:"coimbra-own-cloud.firebaseapp.com",databaseURL:"https://coimbra-own-cloud.firebaseio.com",projectId:"coimbra-own-cloud",storageBucket:"coimbra-own-cloud.appspot.com",messagingSenderId:"571851800778"});var f=firebase.storage().ref(),g=document.body,y=document.documentElement,p=Math.max(g.scrollHeight,g.offsetHeight,y.clientHeight,y.scrollHeight,y.offsetHeight);function h(e,t){o.style.display="block",m.style.animation="errorIn 1s",m.getElementsByTagName("p")[0].innerHTML=e,m.getElementsByTagName("p")[1].innerHTML=t}y.style.height=p+"px",$("button").click(function(){var e=$(this);e.css("animation","btnClick .4s"),setTimeout(function(){e.removeAttr("style")},450)}),document.querySelector(".modal-message .main-window .msg-content .cancel").addEventListener("click",function(){m.style.animation="errorOut 1s",setTimeout(function(){o.style.display="none"},1e3)}),document.getElementById("key-form").addEventListener("focusout",function(){console.log("focus out"),setTimeout(function(){document.querySelector(".key").style.display="inline-block",document.querySelector(".input-controls").style.display="none"},200)}),document.addEventListener("click",function(n){if(n.target){if(n.target.classList.contains("fa-trash-alt")){o=n.target.parentElement.parentElement.getAttribute("name"),console.log("name: "+o);var e=n.target.parentElement.parentElement.childNodes[0].nodeValue;console.log("file to remove: ",e),f=firebase.storage().ref(a+"/"+e).delete().then(function(){firebase.database().ref("files/"+a).child(o).remove().catch(function(e){console.log("some error in removing child in database"),h("deleting from list",e)}),firebase.database().ref("files/"+a).once("value").then(function(e){console.log("***Delete***",e.val());var t={},o=1;for(var l in e.val())"CreateDate"==l?t.CreateDate=e.val()[l]:(t[o]=e.val()[l],o++);firebase.database().ref("files/"+a).set(t),n.target.parentElement.parentElement.remove()}).catch(function(e){console.log("some error in restructuring list after deleting"),h("restructuring after deleting",e)})}).catch(function(e){console.log("File not removed!!!",e),h("file not removed",e)})}if(n.target.classList.contains("fa-cloud-download-alt")){o=n.target.parentElement.parentElement.getAttribute("name"),console.log("name: "+o);var t=n.target.parentElement.parentElement.textContent;console.log("file to load: ",t)}switch(n.target.classList.contains("cancel")&&n.target.parentElement.classList.toggle("visible"),(n.target.classList.contains("line-1")||n.target.classList.contains("line-2"))&&n.target.parentElement.parentElement.classList.toggle("visible"),"upload-file"==n.target.parentElement.id&&(a=generateKey(7),console.log("storage key: ",a),firebase.database().ref("files").child(a).once("value").then(function(e){e.val()&&(console.log("keystorage exist!"),$(".file-list ul").empty(),e.forEach(function(e){var t=e.key;if(console.log("upload data key: ",t),"CreateDate"!=t){var o='<li name="'+t+'"">'+e.val()+'<div class="icon-wrap text-right"><i class="fas fa-trash-alt"><span class="tooltip">Видалити файл</span></i></div></li>';$(".file-list ul").append(o),p=Math.max(g.scrollHeight,g.offsetHeight,y.clientHeight,y.scrollHeight,y.offsetHeight),y.style.height=p+"px"}}))}).catch(function(e){console.log("some error in upload file"),h("uploading file",e)}),i.style.animation="fadeOut 1s",setTimeout(function(){i.style.display="none",p=Math.max(g.scrollHeight,g.offsetHeight,y.clientHeight,y.scrollHeight,y.offsetHeight),y.style.height=p+"px"},1e3),console.log("upload file!"),r.style.display="block",c.style.animation="showLeft 1s",c.style.display="block",setTimeout(function(){d.style.animation="listAnim 1s",d.style.display="block"},1e3),document.querySelector(".key").innerHTML=a),"download-file"==n.target.parentElement.id&&(i.style.animation="fadeOut 1s",setTimeout(function(){i.style.display="none",console.log(u),u.style.animation="showLeft 1s",u.style.display="block"},800)),n.target.classList.contains("modal-message")&&(m.style.animation="errorOut 1s",setTimeout(function(){n.target.style.display="none"},1e3)),n.target.id){case"key-button":console.log("switch: key-button"),document.querySelector("p.wrong-key").innerHTML="";var s=document.getElementById("file-key").value;s?(console.log("key-button: ",s),firebase.database().ref("files/"+s).once("value",function(e){if(e.val()){document.getElementById("file-key").value="",console.log("Folder exist");var t=document.querySelector(".key-input");document.querySelector(".file-list .key").innerHTML=s,t.style.animation="showUp 1s",setTimeout(function(){c.style.display="none",t.style.display="none",r.style.animation="",document.getElementById("meeseeks").style.display="block",r.style.display="block",d.style.animation="listAnim 1s",d.style.display="block"},1e3),$(".file-list ul").empty(),f=firebase.storage().ref(),e.forEach(function(e){var o=e.key,l=e.val();console.log("Download files key: "+o+"  "),"CreateDate"!=o&&f.child(s+"/"+l).getDownloadURL().then(function(e){var t='<li name="'+o+'"">'+l+'<div class="icon-wrap text-right"><a href="'+e+'" target="_blank" download><i class="fa fa-cloud-download-alt"><span class="tooltip">Завантажити</span></i></a></div></li>';$(".file-list ul").append(t),p=Math.max(g.scrollHeight,g.offsetHeight,y.clientHeight,y.scrollHeight,y.offsetHeight),y.style.height=p+"px"}).catch(function(e){console.log("download error: ",e),h("download",e)})})}else console.log("folder is not exist"),document.querySelector("p.wrong-key").innerHTML="ключ введено невірно або <br> файлів за цим ключем не завантажено"}).catch(function(e){console.log("some error in key-button"),h("key button",e)})):document.querySelector("p.wrong-key").innerHTML="Введіть ключ!";break;case"how2use":console.log("switch: how2use"),document.querySelector(".rules").classList.contains("visible")&&document.querySelector(".rules").classList.remove("visible");var o=document.querySelector(".howuse");console.log("elem: ",o),o.classList.toggle("visible");break;case"rules":console.log("read this rules!!!"),document.querySelector(".howuse").classList.contains("visible")&&document.querySelector(".howuse").classList.remove("visible");o=document.querySelector(".rules");console.log("elem: ",o),o.classList.toggle("visible");break;case"input-key":console.log("switch: input key"),document.querySelector(".key").style.display="none",document.querySelector(".input-controls").style.display="inline-block",document.getElementById("key-form").focus();break;case"key-form-submit":var l=document.getElementById("key-form").value;console.log("input value: ",l),firebase.database().ref("files/"+l).once("value").then(function(e){e.val()&&l?(console.log("key exist"),a=l,$(".file-list ul").empty(),document.querySelector(".key").innerHTML=l,e.forEach(function(e){var t=e.key;if(console.log("upload data key: ",t),"CreateDate"!=t){var o='<li name="'+t+'"">'+e.val()+'<div class="icon-wrap text-right"><i class="fas fa-trash-alt"><span class="tooltip">Видалити файл</span></i></div></li>';$(".file-list ul").append(o),p=Math.max(g.scrollHeight,g.offsetHeight,y.clientHeight,y.scrollHeight,y.offsetHeight),y.style.height=p+"px"}})):(console.log("key doesn't exist"),h("Введіть дійсний ключ!","файли за даним ключем відсутні"),document.getElementById("key-form").value="")}).catch(function(e){console.log("some error in key form submit"),h("key form submit",e)}),document.querySelector(".key").style.display="inline-block",document.querySelector(".input-controls").style.display="none";break;case"logo":console.log("logo click"),console.log("my key: ",generateKey(7)),r.style.animation="fadeOut 1s",setTimeout(function(){r.style.display="none",document.getElementById("meeseeks").style.display="none",i.style.display="block",i.style.animation="fadeIn 1s",u.style.display="none"},1e3),a=s="",d.getElementsByTagName("ul")[0].innerHTML='<li class="template">завантажте файли</li>'}}}),$("#send").click(function(){n?firebase.database().ref("files/"+a).once("value").then(function(e){if(7<Object.size(e.val())+1)return console.log("count of files is to large"),void h("Ліміт файлів в сховищі перевищено!","storage overflow");for(var t in e.val())if(e.val()[t]===n.name)return console.log("this file is already exist!"),void h("Даний файл вже завантажено","file already exist");(f=firebase.storage().ref(a+"/"+n.name)).put(n).on("state_changed",onProgress,onError,function(){onSuccess(n.name,a)}),console.log("file: ",n),console.log("storage Ref: ",f)}).catch(function(e){console.log("some error in #send"),h("#send file",e)}):h("Спочатку виберіть файл з діалогового вікна, або перетяніть його на файлову форму","")})}),Object.size=function(e){var t,o=0;for(t in e)e.hasOwnProperty(t)&&o++;return o};